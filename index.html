<html>
<head>
  <script src="https://cdn.rawgit.com/konvajs/konva/1.6.5/konva.js"></script>
  <meta charset="utf-8">
  <title>Code Of Strategy</title>
  <link rel="Shortcut Icon" type="image/x-icon" href="warrior.png">
   <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: #F0F0F0;
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <script>
    var CoS={
        soldier:function(config){
            var shape = new Konva.Group({
                x: config.x,
                y: config.y,
                rotation: 10
            });

            var face = new Konva.Circle({
                x: 0,
                y: 0,
                radius: 5,
                fill: 'pink',
                stroke: 'black',
                strokeWidth: 0.5
            });

            var helmet = new Konva.Wedge({
                x: 0,
                y: 0,
                radius: 5,
                angle: 240,
                fill: '#0ff',
                stroke: 'black',
                strokeWidth: .5,
                rotation: -30
            });

            var shield = new Konva.Line({
                points: [7,3,  9,3, 9,-3,  7,-3],
                fill: 'chocolate',
                stroke: 'black',
                strokeWidth: .5,
                closed : true,
                rotationDeg: -165
            });

            // var sword = new Konva.Line({
            //     points: [7,0,  11,-1, 15,0,  11,+1],
            //     fill: '#999',
            //     stroke: 'black',
            //     strokeWidth: .5,
            //     closed : true,
            //     rotation: -90
            // });
            var sword = new Konva.Line({
                points: [0,-1, 1,0, 0,1, -1,0],
                // points: [0,-10, 1,-15, 0,-20, -1,-15],
                fill: '#999',
                stroke: 'black',
                strokeWidth: .5,
                closed : true,
                scaleY : 2,
                y : -9
            });

            var wield = new Konva.Arc({
                innerRadius:  15,
                outerRadius: 16,
                angle: 150,
                fill: '#faa',
                stroke: '#f00',
                strokeWidth: .1 ,
                rotation: -150,
                visible:false
            })

            shape.add(face)
            shape.add(helmet)
            shape.add(shield)
            shape.add(wield)
            shape.add(sword)



            var prope={
                speed:10,
                angSp:180,
                blood:20
            }

            var actio={
                move:0,
                rote:0,
                swip:300,
                chop:200
            }

            var funcs={
                move:function(set){actio.move=set},
                rote:function(set){actio.rote=set},
                swip:function(set){if(actio.swip=300){actio.swip=0}},
                chop:function(set){if(actio.chop=200){actio.chop=0}}
            }

            var opera=function(){
                if(actio.move==1){shape.move({x:.1,y:0})}

                if(actio.rote!=0){shape.rotate(actio.rote*prope.angSp/100)}

                // if(actio.swip<300){
                //     actio.swip+=1
                //     if(actio.swip<20){sword.rotate(-60./20)}
                //     else if(actio.swip<30){
                //         sword.rotate(150./10)
                //         wield.visible(true)
                //     }
                //     else if(actio.swip<100){
                //         sword.rotate(-90./70)
                //         wield.visible(false)
                //     }
                //     else{sword.rotation(-90)}   
                // }

                if(actio.chop<200){
                    actio.chop+=1
                    if(actio.chop<20){
                        sword.scaleY(sword.attrs.scaleY+1./20)
                        sword.move({x:0,y:6/20})
                    }
                    else if(actio.chop<30){
                        sword.scaleY(sword.attrs.scaleY-1./10)
                        sword.move({x:0,y:-6/10})
                    }
                    else if(actio.chop<40){
                        sword.scaleY(sword.attrs.scaleY+3./10)
                        sword.move({x:0,y:-6/10})
                    }
                    else if(actio.chop<100){
                        sword.scaleY(sword.attrs.scaleY-3./60)
                        sword.move({x:0,y:6/60})
                    }
                    else{
                        sword.scaleY(2),
                        sword.y(-9)
                    }   
                }
            }

            return {
                shape:shape,
                actio:actio,
                funcs:funcs,
                opera:opera
            }   
        }
    }

//==================================================


    var w1=new CoS.soldier({x:100,y:50})
    var w2=new CoS.soldier({x:50,y:100})


    var width = window.innerWidth;
    var height = window.innerHeight;
    
    var stage = new Konva.Stage({
        container: 'container',
        width: width,
        height: height
    });

    var layer1 = new Konva.Layer();



    layer1.add(w1.shape)
    layer1.add(w2.shape)

    // w1.move({x:10})
    // w1.rotate(90)

    stage.add(layer1);

    stage.scale({x: 2, y: 2})
    stage.batchDraw();

    w1.opera()
    t=0
    // w1.funcs.swip(1)
    // w1.funcs.rote(1)
    // setInterval('t+=1;if(w1.actio.swip==300){w1.funcs.swip()};w1.opera();stage.batchDraw();',10)
    setInterval('t+=1;if(w1.actio.chop==200){w1.funcs.chop()};w1.opera();stage.batchDraw();',10)

  </script>
</body>
</html>
